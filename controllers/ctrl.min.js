(function(){
    /*global angular*/
    var mundial = angular.module("mundial");
    
    mundial.controller("BairrosController",['$scope','$log','$uibModal', 'BairrosService', function($scope,$log, $uibModal, BairrosService){
        
        $scope.title = "Bairros";
        $scope.arrayBairros = BairrosService.query();
        
        $scope.bairro = {}; ////////////////////////////////
        
        var appScopeModal = {
            showInfo : function(row) {
                
                var modalInstance = $uibModal.open({
                    controller: 'DetalheBairroController',
                    templateUrl: 'ngTemplate/detalheBairro.html',
                    resolve: {
                        selectedRow: function () {        
                        debugger;
                        $scope.bairro = row.entity; //////////////////////////////
                        return row.entity;
                        }
                    }
                });
            
                modalInstance.result.then(function (selectedItem) {
                    $log.log('modal selected Row: ' + selectedItem);
                }, function () {
                    $log.info('Modal dismissed at: ' + new Date());
                });
              }
        };
        
        $scope.gridBairros = angular.defaultGridConfig;
        $scope.gridBairros.appScopeProvider = appScopeModal;
        $scope.gridBairros.data = $scope.arrayBairros;
        $scope.gridBairros.columnDefs = [
          {field: 'cod_bairro', displayName: 'Código'},
          {field: 'nom_bairro', displayName: 'Nome', enableCellEdit:true },
          {field: 'cod_estado', displayName: 'Estado'},
          {field: 'cod_municipio', displayName: 'Município'},
          
          //{name: 'edit', displayName: 'Editar', cellTemplate: '<button id="editBtn" type="button" class="btn-small" ng-click="edit(row.entity)" >Editar</button> '}
        ];
        
        //eventos da página
        $scope.ok = function(){
            alert("OK");  
        };
        
        $scope.salvar = function(){
            debugger;    
            //ADICIONAR A VALIDAÇÃO
    
            BairrosService.save(function(){
                
                // INCLUIR O NOVO OBJETO NO ARRAY DO GRID
                $scope.arrayBairros.push(bairro);
                
                // LIMPAR OS TEXTBOXES 
            });
        }; // fim do salvar
        
        $scope.atualizar = function(){
            debugger;
            BairrosService.update({ id : bairro.cod_bairro }, bairro);    
        };// fim do atualizar
        
    }]); //fim do Controller
    
     mundial.controller('DetalheBairroController', 
    ['$scope', '$uibModal', '$uibModalInstance', '$filter', '$interval', 'selectedRow', 'ClientesService',
        function ($scope, $uibModal, $uibModalInstance, $filter, $interval, selectedRow, ClientesService) {
    
            $scope.selectedRow = selectedRow;
    
           $scope.ok = function () {
                $scope.selectedRow = null;
                $uibModalInstance.close();
            };
    
            $scope.cancel = function () {
                $scope.selectedRow = null;
                $uibModalInstance.dismiss('cancel');
            };
            
            $scope.salvar = function(c){
                debugger;
                ClientesService.save(c, function(){
                    console.log('salvo');
                    alert(c.nom_cliente);
                });
            
            };
        }
    ]); // fim da definição do controller de detalhe
    
})();
/*

*/
(function(){
    
    /*global angular*/
    
    var mundial = angular.module("mundial");
    
    mundial.controller("ContinentesController",['$scope','$cookies','$log','$uibModal', 'ContinentesService','uiGridConstants', 'uiGridGroupingConstants', function($scope, $cookies, $log, $uibModal, ContinentesService,uiGridConstants,uiGridGroupingConstants){
        debugger;
        
        $scope.title = "Continentes";
        
        var arrayClientes = ContinentesService.query();
        
        //var umContinente = ContinentesService.get({ id: 1 }, function() {
        //    debugger;
        //    console.log(umContinente);
        //}); // get() returns a single entry
        
         var appScopeModal = {

            showInfo : function(row) {
                
                var modalInstance = $uibModal.open({
                    controller: 'DetalheContinenteController',
                    templateUrl: 'ngTemplate/detalheContinente.html',
                    resolve: {
                      selectedRow: function () {                    
                          return row.entity;
                      }
                    }
                });
            
                modalInstance.result.then(function (selectedItem) {
                    $log.log('modal selected Row: ' + selectedItem);
                }, function () {
                    $log.info('Modal dismissed at: ' + new Date());
                });
            }
        };
        
        $scope.gridContinentes = angular.defaultGridConfig;
        $scope.gridContinentes.appScopeProvider = appScopeModal;
        $scope.gridContinentes.data = arrayClientes;
        $scope.gridContinentes.columnDefs =  [
              //{field: 'cod_cliente', displayName: 'Código', enableCellEdit:false, aggregationType: uiGridConstants.aggregationTypes.max, hidden:true},
              {field: 'nom_continente', displayName: 'Continente'},
              {field: 'sit_continente', enableCellEdit:true, displayName: 'Situação'},
              //{name: 'edit', displayName: 'Editar', cellTemplate: '<button id="editBtn" type="button" class="btn-small" ng-click="editar(row.entity)" >Editar</button> '}
        ];
        
        // recuperando o valor de um cookie
        var usuario = $cookies.getObject('usuario');

    }]); //fim da definição do controller
    
    mundial.controller('DetalheContinenteController', 
    ['$scope', '$uibModal', '$uibModalInstance', '$filter', '$interval', 'selectedRow', 'ContinentesService',
        function ($scope, $uibModal, $uibModalInstance, $filter, $interval, selectedRow, ContinentesService) {
    
            $scope.selectedRow = selectedRow;
    
           $scope.ok = function () {
                $scope.selectedRow = null;
                $uibModalInstance.close();
            };
    
            $scope.cancel = function () {
                $scope.selectedRow = null;
                $uibModalInstance.dismiss('cancel');
            };
            
            $scope.atualizar = function(c){
                debugger;
                ClientesService.update({id: c.cod_cliente},c , function(){
                    debugger;
                    console.log('salvo');
                    alert(c.nom_cliente);
                });
            
            };
        }
    ]); // fim da definição do controller de detalhe
    
})();
(function(){
    var mundial = angular.module("mundial");
    
    mundial.controller("HomeController",['$scope', '$cookies','$location', function($scope, $cookies,$location){
        debugger;
        var usuario = $cookies.getObject('usuario');
        
        if (!usuario) {
            $location.url('/login');
        }else{
            $scope.mensagem = "Bem vindo " + usuario.nom_usuario;    
        }
        
        
        
        
    }]);
})();
(function(){
    var mundial = angular.module("mundial");
    
    mundial.controller("LoginController",['$scope', '$cookies','$location','LoginService', function($scope, $cookies,$location,LoginService){
        debugger;
        $scope.mensagem = "Bem Vindo";            
        
        
        
        $scope.autenticar = function() {
            debugger;
            
            // submeter login e senha para a tabela de usuários, e preencher o objeto com o usuário que veio da API
            var loginService = new LoginService({dsc_login_usuario: $scope.login, dsc_senha_usuario:$scope.senha });
            
            loginService.$autenticar((d)=> {
                debugger;
                console.log(d);
                
                if(d.cod_usuario !== undefined && d.nom_usuario !== undefined){
                    $cookies.putObject('usuario', d);
                    $location.url('/');
                }else{
                    $cookies.remove('usuario', d);
                    $location.url('/login');
                }
            });        
        };//fim de $scope.autenticar    
    }]);
})();
(function(){
    var mundial = angular.module("mundial");
    
    mundial.controller("RegioesController",['$scope', function($scope){
        
        $scope.title = "Regioes do controller";
        
    }]);
})();
(function () {
    "use strict";
    /*global angular*/
    
    var mundial = angular.module("mundial");
    
    mundial.controller("ClientesController", ['$scope', '$cookies', '$log', '$uibModal', 'ClientesService', 'uiGridConstants', 'uiGridGroupingConstants', '$location','$http', function ($scope, $cookies, $log, $uibModal, ClientesService, uiGridConstants, uiGridGroupingConstants, $location, $http) {
        
        debugger;
        var usuario = $cookies.getObject('usuario');
        if (!usuario) {
            $location.url('/login');
        }
        
        $scope.cli = {}; // objeto da tela -> VIEW MODEL
        
        $scope.clientes = [];
        
        /* CRUD -----------------------------------------------------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        
        $scope.obterClientePorId = function(item){
            debugger;
            // buscar um cliente
            var partesTextbox = item.split('-');
            var cod_cliente = Number(partesTextbox.reverse()[0].trim());
            
            return $http.get('//mundialerp.gear.host/api/clientes/', {
              params: {
                id: cod_cliente 
              }
            }).then(function(response){ // essa função é invocada quando a resposta da request chega.
                debugger;
                // aqui eu uso o retorno da api para montar um objeto cliente e o angular popula a tela automaticamente.
                $scope.cli = response.data; 
            });
        };
                       
        $scope.salvar = function (cli) {
            
           ClientesService.save(cli, function onSuccess(d){
               debugger;
               $scope.cli = {};
           }, function onError(e){
               console.log(e);
           });
        };
        
        /*FIM DO CRUD -----------------------------------------------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        
        
        /* EVENTOS E COMPONENTES DA TELA ----------------------------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        $scope.formatos = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];
        $scope.formato = $scope.formatos[0];
        
        $scope.dateOptions = {
            //dateDisabled: disabled,
            formatYear: 'yyyy',
            maxDate: new Date(2020, 5, 22),
            //minDate: new Date(),
            startingDay: 1
        };
        // Disable weekend selection
        function disabled(data) {
            var date = data.date, mode = data.mode;
            return mode === 'day' && (date.getDay() === 0 || date.getDay() === 6);
        }
        
        $scope.open1 = function() {
            $scope.popup1.opened = true;
        };
        
        $scope.popup1 = {
            opened: false
        };
        
        $scope.altInputFormats = ['M!/d!/yyyy'];
        
        
        
        // autocompletar (aqui chamado de typeahead)
        $scope.obterClientes = function(val) {
            debugger;
            return $http.get('//mundialerp.gear.host/api/clientes/', {
              params: {
                nom_cliente: val //startswith
              }
            }).then(function(response){
                debugger;
                $scope.clientes = response.data;
                
                return response.data.map(function(c){
                    return c.nom_cliente + " - " + c.cod_cliente;
                });
            });
        };
        
        $scope.limpar = function(){
            $scope.cli = {};
        };
        
        /* FIM DA DEFINIÇÃO DE EVENTOS E COMPONENTES DA TELA --------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        
        
        
        /*var arrayClientes = ClientesService.query(function(){
            
            console.log("");
        /});
        
        var umCliente = ClientesService.get({ id: 1 }, function() {
            debugger;
            console.log(umCliente);
        }); // get() returns a single entry
        */
        
        /* var appScopeModal = {

            showInfo : function(row) {
                
                var modalInstance = $uibModal.open({
                    controller: 'DetalheClienteController',
                    templateUrl: 'ngTemplate/detalheCliente.html',
                    resolve: {
                      selectedRow: function () {                    
                          return row.entity;
                      }
                    }
                });
            
                modalInstance.result.then(function (selectedItem) {
                    $log.log('modal selected Row: ' + selectedItem);
                }, function () {
                    $log.info('Modal dismissed at: ' + new Date());
                });
            }
        };
        
        $scope.gridClientes = angular.defaultGridConfig;
        $scope.gridClientes.appScopeProvider = appScopeModal;
        //$scope.gridClientes.data = arrayClientes;
        $scope.gridClientes.data = [];
        $scope.gridClientes.columnDefs =  [
              //{field: 'cod_cliente', displayName: 'Código', enableCellEdit:false, aggregationType: uiGridConstants.aggregationTypes.max, hidden:true},
              {field: 'nom_cliente', displayName: 'Nome'},
              {field: 'num_telefone1', displayName: 'Telefone'},
              {field: 'nom_municipio', enableCellEdit:true, displayName: 'Município'},
              {field: 'dsc_sigla_estado', enableCellEdit:true, displayName: 'UF'},
              {field: 'sit_cliente', enableCellEdit:true, displayName: 'Situação'},
              //{name: 'edit', displayName: 'Editar', cellTemplate: '<button id="editBtn" type="button" class="btn-small" ng-click="editar(row.entity)" >Editar</button> '}
        ];
        */
        
/*
                                    cod_cliente = c.cod_cliente,
                                    nom_cliente = c.nom_cliente,
                                    num_telefone1 = c.num_telefone1,
                                    nom_municipio = m.nom_municipio,
                                    dsc_sigla_estado = es.dsc_sigla_estado,
                                    sit_cliente = c.sit_cliente
*/        
        
        
        // recuperando o valor de um cookie
        
        
        
    }]); //fim da definição do controller
    /*
    mundial.controller('DetalheClienteController', ['$scope', '$uibModal', '$uibModalInstance', '$filter', '$interval', 'selectedRow', 'ClientesService', function ($scope, $uibModal, $uibModalInstance, $filter, $interval, selectedRow, ClientesService) {
    
            $scope.selectedRow = selectedRow;
    
           $scope.ok = function () {
                $scope.selectedRow = null;
                $uibModalInstance.close();
            };
    
            $scope.cancel = function () {
                $scope.selectedRow = null;
                $uibModalInstance.dismiss('cancel');
            };
            
            $scope.atualizar = function(c){
                debugger;
                ClientesService.update({id: c.cod_cliente},c , function(){
                    debugger;
                    console.log('salvo');
                    alert(c.nom_cliente);
                });
            
            };
        }
    ]); // fim da definição do controller de detalhe
    */
})();
(function () {
    "use strict";
    /*global angular*/
    
    var mundial = angular.module("mundial");
    
    mundial.controller("FornecedoresController", ['$scope', '$cookies', '$log', '$uibModal', 'ClientesService', 'uiGridConstants', 'uiGridGroupingConstants', '$location','$http', function ($scope, $cookies, $log, $uibModal, ClientesService, uiGridConstants, uiGridGroupingConstants, $location, $http) {
        
        debugger;
        var usuario = $cookies.getObject('usuario');
        if (!usuario) {
            $location.url('/login');
        }
        
        $scope.fornecedor = {}; // objeto da tela -> VIEW MODEL
        
        $scope.fornecedorentes = [];
        
        /* CRUD -----------------------------------------------------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        
        $scope.obterClientePorId = function(item){
            debugger;
            // buscar um cliente
            var partesTextbox = item.split('-');
            var cod_cliente = Number(partesTextbox.reverse()[0].trim());
            
            return $http.get('//mundialerp.gear.host/api/clientes/', {
              params: {
                id: cod_cliente 
              }
            }).then(function(response){ // essa função é invocada quando a resposta da request chega.
                debugger;
                // aqui eu uso o retorno da api para montar um objeto cliente e o angular popula a tela automaticamente.
                $scope.fornecedor = response.data; 
            });
        };
                       
        $scope.salvar = function (cli) {
            
           ClientesService.save(cli, function onSuccess(d){
               debugger;
               $scope.fornecedor = {};
           }, function onError(e){
               console.log(e);
           });
        };
        
        /*FIM DO CRUD -----------------------------------------------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        
        
        /* EVENTOS E COMPONENTES DA TELA ----------------------------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        /* ----------------------------------------------------------------------------------------*/
        $scope.formatos = ['dd/MM/yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate'];
        $scope.formato = $scope.formatos[0];
        
        $scope.dateOptions = {
            //dateDisabled: disabled,
            formatYear: 'yyyy',
            maxDate: new Date(2020, 5, 22),
            //minDate: new Date(),
            startingDay: 1
        };
        // Disable weekend selection
        function disabled(data) {
            var date = data.date, mode = data.mode;
            return mode === 'day' && (date.getDay() === 0 || date.getDay() === 6);
        }
        
        $scope.open1 = function() {
            $scope.popup1.opened = true;
        };
        
        $scope.popup1 = {
            opened: false
        };
        
        $scope.altInputFormats = ['M!/d!/yyyy'];
        
        
        
        // autocompletar (aqui chamado de typeahead)
        $scope.obterClientes = function(val) {
            debugger;
            return $http.get('//mundialerp.gear.host/api/clientes/', {
              params: {
                nom_cliente: val //startswith
              }
            }).then(function(response){
                debugger;
                $scope.fornecedorentes = response.data;
                
                return response.data.map(function(c){
                    return c.nom_cliente + " - " + c.cod_cliente;
                });
            });
        };
        
        $scope.limpar = function(){
            $scope.fornecedor = {};
        };
    
        
    }]); //fim da definição do controller
    
})();
(function(){
    /*global angular*/
    
    var mundial = angular.module('mundial');
   
    mundial.factory('ClientesService',['$resource', function ($resource){
                  
      return $resource("http://mundialerp.gear.host/api/clientes/:id", { id: "@cod_cliente" }, {        
        'update': { method:'PUT' },
        'save': {
            method :'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        }  
      });
    }]); //fim da factory.              
})();
(function(){
    var mundial = angular.module('mundial');
   
    mundial.factory('BairrosService',['$resource', function ($resource){
      
      //return $resource("https://api.github.com/users");
      //return $resource("https://mundialerp.gear.host/api/bairros");
      
      return $resource('https://mundialerp.gear.host/api/bairros/:id', null, {
            'update': { method:'PUT' }
      });
      
    }]); //fim da factory.              
})();
(function(){
    /*global angular*/
    
    var mundial = angular.module('mundial');
   
    mundial.factory('LoginService',['$resource', function ($resource){
      
      /*
      return $resource("https://mundialerp.gear.host/api/clientes/:id", null, {
            'update': { method:'PUT' }
      });
      */
                  
      return $resource("https://mundialerp.gear.host/api/usuarios/:id", { id: "@cod_usuario" }, {        
        'update': { method:'PUT' },
        'save': {
            method :'POST',
            headers: {
            'Content-Type': 'application/json'
            }
        },
        'autenticar': { 
            url: 'https://mundialerp.gear.host/api/usuarios/', 
            method: 'GET', 
            params:{ 
                dsc_login_usuario: '@dsc_login_usuario', 
                dsc_senha_usuario: '@dsc_senha_usuario'
            }
        }  
      });
      
        
      
      
    }]); //fim da factory.              
})();